services:
  api:
    image: ${GHCR_IMAGE_BASE:-ghcr.io/wendelmax/simarch}-api:latest
    container_name: simarch-api
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:5000
      HTTP_PORTS: "5000"
      CORS_ORIGINS: ${CORS_ORIGINS:-http://localhost,http://localhost:80,http://localhost:5001}
      RATE_LIMIT_PER_MINUTE: ${RATE_LIMIT_PER_MINUTE:-120}
    ports:
      - "5000:5000"
    expose:
      - "5000"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 10s
      timeout: 5s
      retries: 12
      start_period: 60s
    restart: unless-stopped

  web:
    image: ${GHCR_IMAGE_BASE:-ghcr.io/wendelmax/simarch}-web:latest
    container_name: simarch-web
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ASPNETCORE_URLS: http://+:5001
      HTTP_PORTS: "5001"
      ReverseProxy__Clusters__api__Destinations__destination1__Address: http://api:5000
    ports:
      - "5001:5001"
      - "80:5001"
    expose:
      - "5001"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5001/health"]
      interval: 10s
      timeout: 5s
      retries: 12
      start_period: 60s
    depends_on:
      api:
        condition: service_healthy
    restart: unless-stopped
