services:
  api:
    image: ${GHCR_IMAGE_BASE:-ghcr.io/wendelmax/simarch}-api:latest
    container_name: simarch-api
    ports:
      - "5000:5000"
    expose:
      - "5000"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  web:
    image: ${GHCR_IMAGE_BASE:-ghcr.io/wendelmax/simarch}-web:latest
    container_name: simarch-web
    ports:
      - "5001:5001"
    expose:
      - "5001"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5001/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  gateway:
    image: ${GHCR_IMAGE_BASE:-ghcr.io/wendelmax/simarch}-gateway:latest
    container_name: simarch-gateway
    ports:
      - "${GATEWAY_HTTP_PORT:-80}:80"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    depends_on:
      api:
        condition: service_healthy
      web:
        condition: service_healthy
    restart: unless-stopped
