services:
  api:
    image: ${GHCR_IMAGE_BASE:-ghcr.io/wendelmax/simarch}-api:latest
    container_name: simarch-api
    ports:
      - "5000:5000"
    expose:
      - "5000"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 10s
      timeout: 5s
      retries: 12
      start_period: 60s
    restart: unless-stopped

  web:
    image: ${GHCR_IMAGE_BASE:-ghcr.io/wendelmax/simarch}-web:latest
    container_name: simarch-web
    environment:
      ReverseProxy__Clusters__api__Destinations__destination1__Address: http://api:5000
    ports:
      - "5001:5001"
      - "80:5001"
    expose:
      - "5001"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5001/health"]
      interval: 10s
      timeout: 5s
      retries: 12
      start_period: 60s
    depends_on:
      api:
        condition: service_healthy
    restart: unless-stopped
